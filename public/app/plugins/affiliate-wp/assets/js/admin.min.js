jQuery(document).ready(function(e){function t(){var t=e("#affiliate-wp-migrate-user-accounts input:checkbox:checked").length,a=e("#affiliate-wp-migrate-user-accounts input[type=submit]");t>0?a.prop("disabled",!1):a.prop("disabled",!0)}if(window.formfield="",e("body").on("click",".affwp_settings_upload_button",function(t){t.preventDefault();var a=e(this);if(window.formfield=e(this).parent().prev(),f){f.open();return}(f=wp.media.frames.file_frame=wp.media({frame:"post",state:"insert",title:a.data("uploader_title"),button:{text:a.data("uploader_button_text")},multiple:!1})).on("menu:render:default",function(e){e.unset("library-separator"),e.unset("gallery"),e.unset("featured-image"),e.unset("embed"),e.set({})}),f.on("insert",function(){f.state().get("selection").each(function(e,t){e=e.toJSON(),window.formfield.val(e.url)})}),f.open()}),window.formfield="",e(".affwp-referrals-export-toggle").click(function(){e(".affwp-referrals-export-toggle").toggle(),e("#affwp-referrals-export-form").slideToggle()}),e(".affwp-datepicker").length&&e(".affwp-datepicker").datepicker({dateFormat:"mm/dd/yy"}),e(".affwp-user-search").each(function(){var t,a,i=e(this),n=i.val(),o=i.data("affwp-status"),s=i.closest("form"),f=s.find(":submit.button-primary"),r=f.val(),l=e(".affwp-user-email-wrap, .affwp-user-pass-wrap"),c=i.hasClass("affwp-enable-on-complete");!0===c&&(a=(t=s.find("input, select")).not(i)),i.on("input",function(){l.hide()}),i.autocomplete({source:ajaxurl+"?action=affwp_search_users&term="+n+"&status="+o,messages:{noResults:c?"":"No users found"},delay:500,minLength:2,position:{offset:"0, -1"},search:function(){i.hasClass("affwp-enable-on-complete")&&(e("div.notice").remove(),l.hide())},open:function(){i.addClass("open")},close:function(){i.removeClass("open")},response:function(t,a){0===a.content.length&&i.hasClass("affwp-enable-on-complete")?(e('<div class="notice notice-error affwp-new-affiliate-error"><p>'+affwp_vars.no_user_found+"</p></div>").insertAfter(i),wp.a11y.speak(affwp_vars.no_user_found,"polite"),s.find("input, select").prop("disabled",!1),e(".affwp-user-email-wrap, .affwp-user-pass-wrap").show(),e(".affwp-user-email").prop("required"),e(".search-description").hide(),f.val(affwp_vars.user_and_affiliate_input)):wp.a11y.speak(affwp_vars.valid_user_selected,"polite")},select:function(){i.hasClass("affwp-enable-on-complete")&&e.ajax({type:"POST",url:ajaxurl,data:{action:"affwp_check_user_login",user:i.val()},dataType:"json",success:function(t){if(t.success){if(!1===t.data.affiliate)s.find("input, select").prop("disabled",!1);else{var a='<a href="'+t.data.url+'">'+affwp_vars.view_affiliate+"</a>";e('<div class="notice notice-info affwp-new-affiliate-error"><p>'+affwp_vars.existing_affiliate+" "+a+"</p></div>").insertAfter(i),i.prop("disabled",!1)}}}}).fail(function(e){window.console&&window.console.log&&console.log(e)})}}),!0===c&&i.on("input",function(){a.prop("disabled",!0),f.val(r)})}),e("body").on("click",".upload_image_button",function(t){t.preventDefault();var a=e(this).prev();if(f){f.open();return}(f=wp.media.frames.file_frame=wp.media({frame:"select",title:"Choose Image",multiple:!1,library:{type:"image"},button:{text:"Use Image"}})).on("menu:render:default",function(e){e.unset("library-separator"),e.unset("gallery"),e.unset("featured-image"),e.unset("embed"),e.set({})}),f.on("select",function(){var t=f.state().get("selection").first().toJSON();a.val(t.url);var i=e("<img />");i.attr("src",t.url),e("#preview_image").empty().append(i),e("#preview_image img")&&e("#preview_image").show()}),f.open()}),e("body").on("click",".affiliates_page_affiliate-wp-referrals .delete",function(e){return!!confirm(affwp_vars.confirm_delete_referral)}),t(),e("body").on("change","#affiliate-wp-migrate-user-accounts input:checkbox",function(){t()}),e("#affwp_add_affiliate #status").change(function(){"active"==e(this).val()?e("#affwp-welcome-email-row").show():(e("#affwp-welcome-email-row").hide(),e("#affwp-welcome-email-row #welcome_email").prop("checked",!1))}),e("#generate-coupon-code-button").on("click",function(t){t.preventDefault(),e.ajax({type:"POST",url:ajaxurl,data:{action:"affwp_generate_coupon_code",affiliate_id:e(this).data("affiliate_id")},dataType:"json",success:function(t){t.success&&t.data.coupon_code&&e("#coupon_code").val(t.data.coupon_code)}})}),"?page=affiliate-wp-settings&tab=coupons"===window.location.search){let a=function(){var e=document.getElementById("affwp_settings[coupon_custom_text]").value;return""===e?"TEXT":e.replace(/[^0-9a-z]/gi,"")},i=function(e){var t=e;return(t=(t=(t=(t=(t=(t=t.replace("{coupon_code}","FGFUVCQOK1")).replace("{user_name}","CREATIVELABS")).replace("{first_name}","BOB")).replace("{coupon_amount}","10")).replace("{custom_text}",a())).toUpperCase(),!0===o())?t:t.replace(/-/g,"")},n=function(){var e=o(),t=document.getElementById("affwp_settings[coupon_format]").options;if(!0===e)for(var a=0;a<t.length;a++)t[a].text=i(p[a]);else for(var a=0;a<t.length;a++)t[a].text=t[a].text.replace(/-/g,"")},o=function(){return e("input[id='affwp_settings[coupon_hyphen_delimiter]']").is(":checked")},s=function(){var t=e("select[id='affwp_settings[coupon_format]'] option:selected")[0].value;!1===o()&&(t=t.replace(/-/g,"")),e("select[id='affwp_settings[coupon_format]'] option:selected")[0].text=t};for(var f,r,l,c=document.getElementById("affwp_settings[coupon_format]").options,p=[],u=0;u<c.length;u++)p.push(c[u].text),c[u].text=i(p[u]);s(),e("select[id='affwp_settings[coupon_format]']").on("change",function(e){n(),s()}),e("input[id='affwp_settings[coupon_hyphen_delimiter]']").on("click",function(e){n(),s()}),e("input[id='affwp_settings[coupon_custom_text]']").on("keyup",function(){for(var e=0;e<c.length;e++)c[e].text=i(p[e])})}e(".affwp-promo-notice").each(function(){let t=e(this),a=t.data("id"),i=t.data("nonce"),n=t.data("lifespan");t.on("click",".notice-dismiss, .affwp-notice-dismiss",function(e){wp.ajax.send("affwp_dismiss_promo",{data:{notice_id:a,nonce:i,lifespan:n},success:function(){t.slideUp("fast");let e=userSettings.uid?userSettings.uid:0;window.localStorage.removeItem("affwp-notice-"+a+"-seen-"+e)}})})});let d=jQuery(".affwp-admin-notice-top-of-page");if(d.length>0){let m=d.detach();jQuery("#wpbody-content").prepend(m);let g=userSettings.uid?userSettings.uid:0,w=m.data("id"),h="affwp-notice-"+w+"-seen-"+g;window.localStorage.getItem(h)?m.show():setTimeout(function(){window.localStorage.setItem(h,!0),d.slideDown()},1500)}if(e.inArray(pagenow,["affiliates_page_affiliate-wp-affiliates","affiliates_page_affiliate-wp-settings"])>-1&&("affiliates_page_affiliate-wp-settings"===pagenow?(r=e(".affwp-referral-rate-type-field"),l=e('input[name="affwp_settings[referral_rate_type]"]')):(r=e("#flat_rate_basis").closest("tr"),l=e("#rate_type")),l.on("change",function(e){"flat"!==e.target.value?r.hide():r.show()})),e.inArray(pagenow,["affiliates_page_affiliate-wp-settings"])>-1){let v=e("#recaptcha_score_threshold");e('input[name="affwp_settings[recaptcha_type]"]').on("change",function(e){if("v3"!==e.target.value){v.hide();return}v.show()})}if("undefined"!=typeof postboxes&&/affiliate-wp/.test(pagenow)&&postboxes.add_postbox_toggles(pagenow),e.inArray(pagenow,["affiliates_page_affiliate-wp-about"])>-1&&e(".affwp-action-button").on("click",function(){let t=e(this);if(t.hasClass("disabled"))return;if(t.hasClass("status-go-to-url")){window.open(t.data("plugin"),"_blank");return}let a=t.text(),i=t.attr("class"),n=t.hasClass("status-missing")?"affwp_install_plugin":"affwp_activate_plugin",o=t.closest(".affwp-addon-action"),s=(t,a,i)=>{t.addClass("affwp-addon-action--"+a).attr("data-content",i).delay(2500).queue(function(){e(this).removeAttr("data-content").removeClass("affwp-addon-action--"+a)})};e.ajax({type:"POST",url:ajaxurl,data:{action:n,nonce:affwp_about_vars.nonce,plugin:t.data("plugin")},dataType:"json",beforeSend:function(){t.text("").removeAttr("class").addClass("affwp-action-button button button-secondary disabled loading")},success:function(e){if(e.success){t.text(affwp_about_vars.i18n.activated),o.find(".status-label").removeClass("status-inactive").addClass("status-active").text(affwp_about_vars.i18n.active),s(o,"ok","affwp_activate_plugin"===n?affwp_about_vars.i18n.pluginActivated:affwp_about_vars.i18n.pluginInstalledAndActivated);return}t.text(a).removeAttr("class").addClass(i),s(o,"error",e.data)},complete:function(){t.removeClass("loading")}}).fail(function(e){t.text(a).removeAttr("class").addClass(i),s(o,"error",affwp_about_vars.i18n.genericError)})}),e.inArray(pagenow,["affiliates_page_affiliate-wp-creatives"])>-1){let b={text_link:{text:""},image:{text:""}};e("#type").on("change",function(t){let a=e("#text"),i=e("#type"),n=e("#image"),o="image"===i.val()?"text_link":"image";if(b[o].text=a.val(),a.val(b[i.val()].text),e(".form-table").attr("data-current-context",e(this).val()),"image"===i.val()){n.closest(".form-row").removeClass("affwp-hidden");return}n.closest(".form-row").addClass("affwp-hidden")})}});
